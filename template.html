<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="static/style.css">
    <link rel="stylesheet" href="static/pygments-light.css" id="pygments-light">
    <link rel="stylesheet" href="static/pygments-dark.css" id="pygments-dark">
</head>
<body>
    <!-- Sidebar TOC on the right -->
    <aside class="toc-sidebar">
        <div class="toc-header">
            <h3>Contents</h3>
            <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
                <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
        </div>
        <nav class="toc-nav">
            {{ toc }}
        </nav>
    </aside>
    
    <div class="container">
        <main>
            {{ content }}
        </main>
    </div>
    <script>
        // Theme toggle functionality
        (function() {
            const themeToggle = document.getElementById('theme-toggle');
            const html = document.documentElement;
            const pygmentsLight = document.getElementById('pygments-light');
            const pygmentsDark = document.getElementById('pygments-dark');
            
            // Get saved theme or default to light
            const savedTheme = localStorage.getItem('theme') || 'light';
            
            // Apply theme on load
            function applyTheme(theme) {
                html.setAttribute('data-theme', theme);
                if (theme === 'dark') {
                    pygmentsLight.disabled = true;
                    pygmentsDark.disabled = false;
                } else {
                    pygmentsLight.disabled = false;
                    pygmentsDark.disabled = true;
                }
            }
            
            applyTheme(savedTheme);
            
            // Toggle theme on button click
            themeToggle.addEventListener('click', function() {
                const currentTheme = html.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                applyTheme(newTheme);
                localStorage.setItem('theme', newTheme);
            });
        })();

        // TOC active section highlighting
        (function() {
            const tocLinks = document.querySelectorAll('.toc-nav a');
            if (tocLinks.length === 0) return;
            
            // Get all headings that have IDs
            const headings = Array.from(document.querySelectorAll('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]'));
            
            function updateActiveLink() {
                let currentHeading = null;
                const scrollPosition = window.scrollY + 100; // offset for better UX
                
                // Find the current heading
                for (let i = headings.length - 1; i >= 0; i--) {
                    if (headings[i].offsetTop <= scrollPosition) {
                        currentHeading = headings[i];
                        break;
                    }
                }
                
                // Update active class
                tocLinks.forEach(link => {
                    link.classList.remove('active');
                    if (currentHeading && link.getAttribute('href') === '#' + currentHeading.id) {
                        link.classList.add('active');
                    }
                });
            }
            
            // Update on scroll with throttling
            let scrollTimeout;
            window.addEventListener('scroll', function() {
                if (scrollTimeout) {
                    window.cancelAnimationFrame(scrollTimeout);
                }
                scrollTimeout = window.requestAnimationFrame(updateActiveLink);
            });
            
            // Initial update
            updateActiveLink();
        })();
    </script>
</body>
</html>

